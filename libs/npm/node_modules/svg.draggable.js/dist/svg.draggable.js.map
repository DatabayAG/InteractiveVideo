{"version":3,"file":"svg.draggable.js","sources":["../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","../src/svg.draggable.js"],"sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import { Box, Element, G, extend, off, on } from '@svgdotjs/svg.js'\n\r\nconst getCoordsFromEvent = (ev) => {\r\n  if (ev.changedTouches) {\r\n    ev = ev.changedTouches[0]\r\n  }\r\n  return { x: ev.clientX, y: ev.clientY }\r\n}\r\n\r\n// Creates handler, saves it\r\nclass DragHandler {\r\n  constructor (el) {\r\n    el.remember('_draggable', this)\r\n    this.el = el\r\n\r\n    this.drag = this.drag.bind(this)\r\n    this.startDrag = this.startDrag.bind(this)\r\n    this.endDrag = this.endDrag.bind(this)\r\n  }\r\n\r\n  // Enables or disabled drag based on input\r\n  init (enabled) {\r\n    if (enabled) {\r\n      this.el.on('mousedown.drag', this.startDrag)\r\n      this.el.on('touchstart.drag', this.startDrag)\r\n    } else {\r\n      this.el.off('mousedown.drag')\r\n      this.el.off('touchstart.drag')\r\n    }\r\n  }\r\n\r\n  // Start dragging\r\n  startDrag (ev) {\n    const isMouse = !ev.type.indexOf('mouse')\n\n    // Check for left button\r\n    if (isMouse && (ev.which || ev.buttons) !== 1) {\r\n      return\r\n    }\r\n\r\n    // Fire beforedrag event\r\n    if (this.el.dispatch('beforedrag', { event: ev, handler: this }).defaultPrevented) {\r\n      return\r\n    }\r\n\r\n    // Prevent browser drag behavior as soon as possible\r\n    ev.preventDefault()\r\n\r\n    // Prevent propagation to a parent that might also have dragging enabled\r\n    ev.stopPropagation()\r\n\r\n    // Make sure that start events are unbound so that one element\r\n    // is only dragged by one input only\r\n    this.init(false)\r\n\r\n    this.box = this.el.bbox()\r\n    this.lastClick = this.el.point(getCoordsFromEvent(ev))\r\n\r\n    // We consider the drag done, when a touch is canceled, too\r\n    const eventMove = (isMouse ? 'mousemove' : 'touchmove') + '.drag'\r\n    const eventEnd = (isMouse ? 'mouseup' : 'touchcancel.drag touchend') + '.drag'\r\n\r\n    // Bind drag and end events to window\r\n    on(window, eventMove, this.drag)\r\n    on(window, eventEnd, this.endDrag)\r\n\r\n    // Fire dragstart event\r\n    this.el.fire('dragstart', { event: ev, handler: this, box: this.box })\r\n  }\r\n\r\n  // While dragging\r\n  drag (ev) {\r\n\r\n    const { box, lastClick } = this\r\n\r\n    const currentClick = this.el.point(getCoordsFromEvent(ev))\r\n    const x = box.x + (currentClick.x - lastClick.x)\r\n    const y = box.y + (currentClick.y - lastClick.y)\r\n    const newBox = new Box(x, y, box.w, box.h)\r\n\r\n    if (this.el.dispatch('dragmove', {\r\n      event: ev,\r\n      handler: this,\r\n      box: newBox\r\n    }).defaultPrevented) return\r\n\r\n    this.move(x, y)\r\n    return newBox\r\n  }\r\n\r\n  move (x, y) {\r\n    // Svg elements bbox depends on their content even though they have\r\n    // x, y, width and height - strange!\r\n    // Thats why we handle them the same as groups\r\n    if (this.el.type === 'svg') {\r\n      G.prototype.move.call(this.el, x, y)\r\n    } else {\r\n      this.el.move(x, y)\r\n    }\r\n  }\r\n\r\n  endDrag (ev) {\n    // final drag\r\n    const box = this.drag(ev)\r\n\r\n    // fire dragend event\r\n    this.el.fire('dragend', { event: ev, handler: this, box })\r\n\r\n    // unbind events\r\n    off(window, 'mousemove.drag')\r\n    off(window, 'touchmove.drag')\r\n    off(window, 'mouseup.drag')\r\n    off(window, 'touchend.drag')\n\n    // Rebind initial Events\n    this.init(true)\n  }\r\n}\r\n\r\nextend(Element, {\r\n  draggable (enable = true) {\r\n    const dragHandler = this.remember('_draggable') || new DragHandler(this)\r\n    dragHandler.init(enable)\r\n    return this\r\n  }\r\n})\r\n"],"names":["getCoordsFromEvent","ev","changedTouches","x","clientX","y","clientY","DragHandler","el","remember","drag","bind","startDrag","endDrag","enabled","on","off","isMouse","type","indexOf","which","buttons","dispatch","event","handler","defaultPrevented","preventDefault","stopPropagation","init","box","bbox","lastClick","point","eventMove","eventEnd","window","fire","currentClick","newBox","Box","w","h","move","G","prototype","call","extend","Element","draggable","enable","dragHandler"],"mappings":"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"}